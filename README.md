# 2021 20.440 Project
Felicia Rodriguez and Cathy Wang

## Overview
20440_proj contains data and code files that compare inflammation and cancer data using 
PCA, t-SNE, and random forest classifier to understand trends in protein expression levels 
among disease. Functionally, there are scripts for data cleaning, exploration, and analyses; 
data files required for running the code; and output figures. 

### Data
Data was generated from experimental data of three papers and found publicly online or 
through contacting the first-author.
Datasets are from: 
- Haudek-Prinz VJ, …, Gerner C. Proteome signatures of inflammatory activated primary 
human peripheral blood mononuclear cells. J Proteomics. 2012 Dec 5;76 Spec No.(5):150-62. 
doi: 10.1016/j.jprot.2012.07.012.
- Fernández-Coto DL, …, Ayala G. Quantitative proteomics reveals proteins involved in the 
progression from non-cancerous lesions to gastric cancer. J Proteomics. 2018 Aug 30;186:15-27. 
doi: 10.1016/j.jprot.2018.07.013. 
- McCaffrey EF, …, Angelo M. Multiplexed imaging of human tuberculosis granulomas uncovers 
immunoregulatory features conserved across tissue and blood. bioRxiv 2020.06.08.140426; 
doi: 10.1101/2020.06.08.140426.

### Structure
- code_analysis/
	- TB_sarc_cell_type_v5.ipynb
		- This provides code for t-SNE calculations and visualizations for the entire
		dataset as well and specific cell types.
		- Data required:
			- TB_sarc_overlap_nodum.csv
			- B_cellsv1.csv
			- Endothelial_cellsv1.csv
			- Macrophagesv1.csv
			- Monocytesv1.csv
			- T_cellsv1.csv
			- ref.csv (Not required for analysis but included as original reference from
			which cell types were extracted; data generated from targeted proteomics approach utilizing Multiplexed Ion
			Beam Imaging by Time-of-Flight (MIBI-TOF))
	- gastric_forest.ipynb
		- This provides code for finding overlapping proteins between granuloma and 
		gastric datasets to use as features in supervised learning. A random forest 
		classifier is trained, optimized with grid search, and tested on granuloma 
		data before application to gastric dataset. 
		- Data required: 
			- gastric_ID_list.csv
			- gastric_clean_unst.csv
			- gran_all_ID.csv
			- TB_sarc_overlap.csv

- code_EDA_PCA/
	- Overlap_between_PBMCs_gastric.ipynb
		- This provides code for the PCA analyis of gastric data with the filtering
		by PBMCs proteins to look at just this subset. Also includes loadings 
		calculations and plotting for top contributors to PC1 and PC2 identified
		through the loadings.
		- Data required:
			- gastric_sampleonly.csv
			- activated_PBMC_trimmed.xls (Data generated by untargeted proteomic 
			approach utilizing iTRAQ - MS)
	- gastric_clean.ipynb
		- This code cleans up the gastric dataset to remove all missing values or 
		unconvertible qualitative data. 
		- Data required:
			- FC2018_protein_quant.xls
	- gastric_PCA.ipynb
		- This code standardizes data, creates a dataframe for protein profiles of 
		patient samples, and performs PCA on gastric data. Also includes loadings 
		calculations and plotting for top contributors to PC1 and PC2 identified
		through the loadings.
		- Data required: 
			- gastric_ID_list.csv
	- granuloma_9PCA.ipynb
		- This code performs PCA on the 9 overlapping proteins between gastric and 
		granuloma datasets. Also includes loadings 
		calculations and plotting for top contributors to PC1 and PC2 identified
		through the loadings.
		- Data required:
			- TB_sarc_overlap_nodum.csv
			- gran_protein9.csv
	- granuloma_cleanPCA.ipynb
		- This code combines and cleans the TB and sarcoidosis datasets to include the
		same column features, standardize cell sizes, and convert categorical variables 
		to dummy variables for better quantitative analyses. PCA was performed
		with targeting for disease, patient ID, and cell lineage, with loading 
		calculations and plottings for top contributors to PC1 and PC2. 
		- Data required: 
			- allTB-sarcoid-scdata.csv
			- NHP-TB-scdata.csv

- data/
	- processed/ (cleaned/relevant lines of data from original datasets for use in scripts)
		- B_cellsv1.csv
		- Endothelial_cellsv1.csv
		- Macrophagesv1.csv
		- Monocytesv1.csv
		- T_cellsv1.csv
		- TB_sarc_overlap_nodum.csv
		- activated_PBMC_trimmed.xls
		- gastric_clean_unst.csv
		- gastric_ID_list.csv
		- gastric_sampleonly.csv
		- gran_protein9.csv
	- raw/ (raw dataset, entire spreadsheet files)
		- allTB-sarcoid-scdata.csv
		- FC2018_protein_quant.xls
		- HaudekPrinz_inflamPBMC2021.xls
		- NHP-TB-scdata.csv

- figures/ (results from plotting)
	- B_cell_tsne.png
	- Endothelial_cell_tsne.png
	- Proteins Identified with Highest Correlation to PCs.png
	- T_cell_tsne.png
	- Total Variance Explained by component number.png
	- Two Component PCA with Filtered Data.png
	- all_cell_types_tsne.png
	- gastric_patient_cumvar_PCA.png
	- gastric_patient_load12.png
	- gastric_patient_PCA.png
	- gran_cumvar_PCA.png	
	- gran_dis_PCA.png
	- gran_lin_nol_PCA.png
	- gran_lin_PCA.png
	- gran_load12.png
	- gran_prot9_cumvar_PCA.png
	- gran_prot9_dis_PCA.png
	- gran_prot9_load12.png
	- gran_sampleID_PCA.png
	- gran_top2_forest.png
	- macropahge_tsne.png
	- monocyte_tsne.png

### Installation/Usage 
Packages used include pandas (1.1.2), numpy (1.19.2), and matplotlib (3.3.2). You can run 
Python (v3.8.3) files in an IDE and generate associated figure(s), after making sure the data 
files are in the same folder as your script. Jupyter Notebook or Conda may be needed to run 
.ipynb files. In order to run with the appropriate file location references, the scripts 
need to be in the parent folder of the datasets; alternatively the system paths can be 
edited to match files in desired locations. 
